<status-bar [color]="backgroundColor"></status-bar>


<ion-header class="ion-no-border">
  <ion-toolbar [color]="backgroundColor">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon color="light" slot="icon-only" name="chevron-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Header</ion-title>
  </ion-toolbar>
</ion-header>


<ion-content [scrollEvents]="true" (ionScroll)="logScrolling($event.detail)" color="primary">
  <ion-grid class="grid-messages" #grid (touchstart)="touchStart()" (touchend)="touchEnd()">
    <fiv-gallery #gallery [ambient]="false" (willOpen)="toggleImageVisibility(false, 300)" (didOpen)="didOpen()"
  (willClose)="willClose()" (didClose)="toggleImageVisibility(true)">

      <fiv-gallery-toolbar position="top">
        <ion-toolbar color="transparent">
          <ion-buttons slot="start">
            <ion-button (click)="gallery.close()">
              <ion-icon color="light" slot="icon-only" name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </fiv-gallery-toolbar>

      <ng-container *ngFor="let message of messages | objectToArray; let i = index">

        <ion-row *ngIf="!onSameDay(i-1, i)">
          <ion-col class="col-date" size="8">
            <div class="date">
              {{ formatDate(message.timestamp, 'LL') }}
            </div>
          </ion-col>
        </ion-row>


        <ion-row class="row-messages">

          <ion-col class="col-message" size="9" [attr.offset]="message.fromMe ? '3': '0'">
            <div *ngIf="!message.isImage; else image" class="div-message" [class.fromMe]="message.fromMe">{{ message.text }}</div>
            <ng-template #image>
              <fiv-gallery-image [src]="message.url" [style.margin-left]="message.fromMe ? 'auto' : null"></fiv-gallery-image>
            </ng-template>
          </ion-col>

          <ion-col size="2" [attr.offset]="message.fromMe ? '0': '3'">
            <div class="time">
              {{ formatDate(message.timestamp, 'HH:mm') }}
            </div>
          </ion-col>

        </ion-row>


      </ng-container>

      <!-- <fiv-gallery-toolbar position="bottom">
        <ion-toolbar color="transparent">
          <div #bottomToolbar class="content">
            <div class="box">
              <ion-img *ngFor="let image of (messages | imageMessages); let i = index" [src]="image.url" class="img" (click)="goTo(i)"></ion-img>
            </div>
          </div>
        </ion-toolbar>
      </fiv-gallery-toolbar> -->

    </fiv-gallery>
  </ion-grid>
</ion-content>



<ion-footer class="footer-message-input">
  <ion-toolbar>
    <ion-row>
      <ion-col size="11" class="col-input">
        <ion-textarea rows="1" #textArea autosize [maxRows]="4" class="message-input" [(ngModel)]="newMessage">
        </ion-textarea>
        <div class="separator-bar"></div>
        <ion-button @cameraButton class="camera-button" fill="clear" *ngIf="!newMessage.length" color="medium" (click)="sendPhoto()">
          <ion-icon slot="icon-only" name="camera-outline"></ion-icon>
        </ion-button>
      </ion-col>
      <ion-col size="1" class="col-button">
        <ion-button fill="clear" [disabled]="!newMessage.length" (click)="sendMessage()">
          <ion-icon slot="icon-only" name="send"></ion-icon>
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-toolbar>
</ion-footer>